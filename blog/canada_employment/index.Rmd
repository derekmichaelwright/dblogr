---
title: "Employment in Canada"
subtitle: "Graphs of Employment data in Canada using STATCAN data"
date: "Last updated: `r Sys.Date()`"
author: "Derek Michael Wright [www.dblogr.com/](http://dblogr.com/) or [derekmichaelwright.github.io/dblogr](https://derekmichaelwright.github.io/dblogr/) <derek.wright@usask.ca>"
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = T, message = F, warning = F)
```

---

# Data

STATCAN Table 14-10-0017-01

> - `r shiny::icon("globe")` https://www150.statcan.gc.ca/t1/tbl1/en/cv.action?pid=1410001701
> - `r shiny::icon("save")` [1410001701_databaseLoadingData.csv](1410001701_databaseLoadingData.csv)

---

# Prepare Data

```{r class.source = 'fold-show'}
# devtools::install_github("derekmichaelwright/agData")
library(agData)
```

```{r}
# Prep data
myCaption <- "www.dblogr.com/ or derekmichaelwright.github.io/dblogr/ | Data: STATCAN"
myAreas <- c("Canada", "British Columbia", "Alberta", "Saskatchewan", 
             "Manitoba", "Nova Scotia","Ontario", "Quebec", 
             "Newfoundland and Labrador", "New Brunswick", 
             "Prince Edward Island", "Yukon", "Nunavut",
             "Northwest Territories")
myColors_Age <- c("darkgreen", "darkorange", "darkred")
myColors_Sex <- c("palevioletred3","steelblue")
#
d1 <- read.csv("1410001701_databaseLoadingData.csv") %>%
  select(Area=GEO, Date=REF_DATE, Measurement=Labour.force.characteristics, 
         Sex, Age=Age.group, Unit=UOM, Scale=SCALAR_FACTOR, Value=VALUE) %>%
  mutate(Area = factor(Area, levels = myAreas),
         Date = as.Date(paste0(Date, "-15"), format = "%Y-%m-%d"))
d2 <- d1 %>% 
  filter(Measurement %in% c("Full-time employment", "Part-time employment")) %>%
  mutate(Year = as.numeric(substr(Date, 1, 4))) %>%
  group_by(Area, Year, Measurement, Sex, Age) %>%
  summarise(Value = sum(Value)) %>% ungroup() %>%
  group_by(Area, Year, Sex, Age) %>% mutate(Total = sum(Value)) %>% ungroup() %>%
  mutate(Percent = 100 * Value / Total)
```

```{r echo = F, eval = F}
ages <- c(# Groups 1
          "15 to 19 years", "20 to 24 years", "25 to 29 years", 
          "30 to 34 years", "35 to 39 years", "40 to 44 years", 
          "45 to 49 years", "50 to 54 years", "55 to 59 years", 
          "60 to 64 years", "65 years and over", "65 to 69 years", 
          "70 years and over",
          # Groups 2
          "15 to 24 years", "25 to 44 years", "45 to 64 years",
          # Groups 3
          "25 to 54 years", "15 to 64 years", 
          #Groups4
          "15 years and over", "25 years and over", 
          "45 years and over", "55 years and over")
```

---

# Canada

## Employment

![](canada_employment_1_01.png)

```{r}
# Prep data
xx <- d1 %>% 
  filter(Area == "Canada", Sex == "Both sexes", Age == "15 years and over",
         Measurement == "Employment rate")
# Plot
mp <- ggplot(xx, aes(x = Date, y = Value)) +
  geom_line(size = 0.75, alpha = 0.7, color = "darkgreen") +
  scale_y_continuous(breaks = seq(52, 64, by = 2), minor_breaks = 50:65) +
  scale_x_date(date_minor_breaks = "year") +
  theme_agData(legend.position = "bottom") +
  labs(title = "Canadian Employment Rate", x = NULL,
       y = "Percent", caption = myCaption)
ggsave("canada_employment_1_01.png", mp, width = 6, height = 4)
```

```{r echo = F}
ggsave("featured.png", mp, width = 6, height = 4)
```

---

## Males vs. Females

![](canada_employment_1_02.png)

```{r}
# Prep data
xx <- d1 %>%
  filter(Area == "Canada", Sex != "Both sexes", Age == "15 years and over",
         Measurement == "Employment rate")
# Plot
mp <- ggplot(xx, aes(x = Date, y = Value, color = Sex)) +
  geom_line(size = 0.75, alpha = 0.8) +
  scale_color_manual(name = NULL, values = myColors_Sex) +
  scale_x_date(date_minor_breaks = "year") +
  theme_agData(legend.position = "bottom") +
  labs(title = "Canadian Employment Rate", x = NULL,
       y = "Percent", caption = myCaption)
ggsave("canada_employment_1_02.png", mp, width = 6, height = 4)
```

---

### > 2010

![](canada_employment_1_03.png)

```{r}
# Prep data
xx <- d1 %>% 
  filter(Area == "Canada", Measurement == "Employment rate", 
         Age == "15 years and over", Sex != "Both sexes", Date > "2010-01-01")
# Plot
mp <- ggplot(xx, aes(x = Date, y = Value, color = Sex)) +
  geom_line(size = 1, alpha = 0.8) +
  scale_color_manual(name = NULL, values = myColors_Sex) +
  scale_y_continuous(breaks = seq(40, 70, by = 5), minor_breaks = 40:70) +
  scale_x_date(date_breaks = "year", date_minor_breaks = "year", 
               date_labels = "%Y") +
  theme_agData(legend.position = "bottom",
               axis.text.x = element_text(angle = 45, hjust = 1)) +
  labs(title = "Canadian Employment Rate", x = NULL,
       y = "Percent", caption = myCaption)
ggsave("canada_employment_1_03.png", mp, width = 6, height = 4)
```

## By Age

![](canada_employment_1_04.png)

```{r}
# Prep data
xx <- d1 %>% 
  filter(Area == "Canada", Sex == "Both sexes", Age != "15 years and over",
         Measurement == "Employment rate")
# Plot
mp <- ggplot(xx, aes(x = Date, y = Value, color = Age)) +
  geom_line(size = 0.75, alpha = 0.7) +
  scale_color_manual(name = NULL, values = myColors_Age) +
  scale_x_date(date_minor_breaks = "year") +
  theme_agData(legend.position = "bottom") +
  labs(title = "Canadian Employment Rate", x = NULL,
       y = "Percent", caption = myCaption)
ggsave("canada_employment_1_04.png", mp, width = 6, height = 4)
```

---

# Provinces

## Employment

![](canada_employment_1_05.png)

```{r}
# Prep data
xx <- d1 %>% 
  filter(Area != "Canada", Sex == "Both sexes", Age == "15 years and over",
         Measurement == "Employment rate")
# Plot
mp <- ggplot(xx, aes(x = Date, y = Value, color = Area)) +
  geom_line(size = 0.5, alpha = 0.7) +
  facet_wrap(Area ~ ., ncol = 5) +
  theme_agData(legend.position = "none") +
  labs(title = "Canadian Employment Rate", x = NULL,
       y = "Percent", caption = myCaption)
ggsave("canada_employment_1_05.png", mp, width = 10, height = 4)
```

---

### > 2010

![](canada_employment_1_06.png)

```{r}
# Prep data
xx <- d1 %>% 
  filter(Area != "Canada", Sex == "Both sexes", Age == "15 years and over",
         Measurement == "Employment rate", Date > "2010-01-01")
# Plot
mp <- ggplot(xx, aes(x = Date, y = Value, color = Area)) +
  geom_line(size = 0.5, alpha = 0.7) +
  facet_wrap(Area ~ ., ncol = 5) +
  scale_x_date(minor_breaks = "year") +
  theme_agData(legend.position = "none",
               axis.text.x = element_text(angle = 45, hjust = 1)) +
  labs(title = "Canadian Employment Rate", x = NULL,
       y = "Percent", caption = myCaption)
ggsave("canada_employment_1_06.png", mp, width = 10, height = 4)
```

---

## Males vs. Females

![](canada_employment_1_07.png)

```{r}
# Prep data
xx <- d1 %>% 
  filter(Area != "Canada", Sex != "Both sexes", Age == "15 years and over",
         Measurement == "Employment rate")
# Plot
mp <- ggplot(xx, aes(x = Date, y = Value, color = Sex)) +
  geom_line(size = 0.4, alpha = 0.8) +
  facet_wrap(Area ~ ., ncol = 5) +
  scale_color_manual(name = NULL, values = myColors_Sex) +
  theme_agData(legend.position = "bottom") +
  labs(title = "Canadian Employment Rate", x = NULL,
       y = "Percent", caption = myCaption)
ggsave("canada_employment_1_07.png", mp, width = 10, height = 4)
```

---

### > 2010

![](canada_employment_1_08.png)

```{r}
# Prep data
xx <- d1 %>% 
  filter(Area != "Canada", Measurement == "Employment rate", 
         Age == "15 years and over", Sex != "Both sexes", Date > "2010-01-01")
# Plot
mp <- ggplot(xx, aes(x = Date, y = Value, color = Sex)) +
  geom_line(size = 1, alpha = 0.8) +
  facet_wrap(Area ~ ., ncol = 5) +
  scale_color_manual(name = NULL, values = myColors_Sex) +
  scale_x_date(date_minor_breaks = "year") +
  theme_agData(legend.position = "bottom",
               axis.text.x = element_text(angle = 45, hjust = 1)) +
  labs(title = "Canadian Employment Rate", x = NULL,
       y = "Percent", caption = myCaption)
ggsave("canada_employment_1_08.png", mp, width = 10, height = 4)
```

---

## By Age

![](canada_employment_1_09.png)

```{r}
# Prep data
xx <- d1 %>% 
  filter(Area != "Canada", Sex == "Both sexes", Age != "15 years and over",
         Measurement == "Employment rate")
# Plot
mp <- ggplot(xx, aes(x = Date, y = Value, color = Age)) +
  geom_line(size = 0.4, alpha = 0.7) +
  facet_wrap(Area ~ ., ncol = 5) +
  scale_color_manual(name = NULL, values = myColors_Age) +
  theme_agData(legend.position = "bottom") +
  labs(title = "Canadian Employment Rate", x = NULL,
       y = "Percent", caption = myCaption)
ggsave("canada_employment_1_09.png", mp, width = 10, height = 4)
```

---

### > 2010

![](canada_employment_1_10.png)

```{r}
# Prep data
xx <- d1 %>% 
  filter(Area != "Canada", Measurement == "Employment rate", 
         Age != "15 years and over", Sex == "Both sexes", Date > "2010-01-01")
# Plot
mp <- ggplot(xx, aes(x = Date, y = Value, color = Age)) +
  geom_line(size = 0.75, alpha = 0.7) +
  facet_wrap(Area ~ ., ncol = 5) +
  scale_color_manual(name = NULL, values = myColors_Age) +
  scale_x_date(date_minor_breaks = "year") +
  theme_agData(legend.position = "bottom",
               axis.text.x = element_text(angle = 45, hjust = 1)) +
  labs(title = "Canadian Employment Rate", x = NULL,
       y = "Percent", caption = myCaption)
ggsave("canada_employment_1_10.png", mp, width = 10, height = 4)
```

---

### Newfoundland vs. Alberta Youth

![](canada_employment_1_11.png)

```{r}
# Prep data
xx <- d1 %>% 
  filter(Area == c("Newfoundland and Labrador","Alberta"), 
         Measurement == "Employment rate", 
         Age == "15 years and over", Sex != "Both sexes")
# Plot
mp <- ggplot(xx, aes(x = Date, y = Value, color = Area)) +
  geom_line(size = 1, alpha = 0.7) +
  facet_wrap(Sex ~ ., ncol = 5) +
  scale_color_manual(name = NULL, values = c("darkred","steelblue")) +
  scale_x_date(date_minor_breaks = "year") +
  theme_agData(legend.position = "bottom") +
  labs(title = "Employment Rate", x = NULL,
       y = "Percent", caption = myCaption)
ggsave("canada_employment_1_11.png", mp, width = 8, height = 4)
```

---

# Full Time vs. Part Time

## Canada

![](canada_employment_2_01.png)

```{r}
# Prep data
xx <- d1 %>% 
  filter(Area == "Canada", Sex != "Both sexes", Age == "15 years and over",
         Measurement %in% c("Full-time employment", "Part-time employment"))
# Plot
mp <- ggplot(xx, aes(x = Date, y = Value / 1000, color = Sex)) +
  geom_line(size = 0.5, alpha = 0.8) +
  facet_wrap(Measurement ~ ., ncol = 2, scales = "free_y") +
  scale_color_manual(name = NULL, values = c("palevioletred3","steelblue")) +
  scale_x_date(date_minor_breaks = "year") +
  theme_agData(legend.position = "bottom") +
  labs(title = "Canada", y = "Million", x = NULL, caption = myCaption)
ggsave("canada_employment_2_01.png", mp, width = 6, height = 4)
```

---

### > 2010

![](canada_employment_2_02.png)

```{r}
# Prep data
xx <- d1 %>% 
  filter(Area == "Canada", Sex != "Both sexes", Age == "15 years and over",
         Measurement %in% c("Full-time employment", "Part-time employment"),
         Date > "2010-01-01")
# Plot
mp <- ggplot(xx, aes(x = Date, y = Value / 1000, color = Sex)) +
  geom_line(size = 0.75, alpha = 0.8) +
  facet_wrap(Measurement ~ ., ncol = 2, scales = "free_y") +
  scale_color_manual(name = NULL, values = c("palevioletred3","steelblue")) +
  scale_x_date(date_minor_breaks = "year") +
  theme_agData(legend.position = "bottom",
               axis.text.x = element_text(angle = 45, hjust = 1)) +
  labs(title = "Canada", y = "Million", x = NULL, caption = myCaption)
ggsave("canada_employment_2_02.png", mp, width = 6, height = 4)
```

---

## 2019 vs > 2019

![](canada_employment_2_03.png)

```{r}
# Prep data
myMeasures <- c("Full-time employment", "Part-time employment")
yy <- d1 %>% 
  filter(Area == "Canada", Sex == "Both sexes", Age == "15 years and over", 
         Date > "2019-03-15", Date < "2020-03-15", 
         Measurement %in% myMeasures) %>%
  group_by(Measurement) %>%
  summarise(Value = mean(Value))
xx <- d1 %>% 
  filter(Area == "Canada", Sex == "Both sexes", 
         Age == "15 years and over", Date > "2020-02-15", 
         Measurement %in% myMeasures) %>%
  mutate(MonthDiff = ifelse(Measurement == myMeasures[1], 
            Value - yy$Value[yy$Measurement == myMeasures[1]],
            Value - yy$Value[yy$Measurement != myMeasures[1]]),
         PosNeg = ifelse(MonthDiff > 0, "Pos", "Neg"))
# Plot
mp <- ggplot(xx, aes(x = Date, y = MonthDiff / 1000, fill = PosNeg)) + 
  geom_bar(stat = "identity", color = "black", alpha = 0.7) +
  scale_fill_manual(values = c("darkred","steelblue")) +
  scale_y_continuous(breaks = c(-2,-1.5,-1,-0.5,0,0.5,1)) +
  facet_grid(. ~ Measurement) +
  theme_agData(legend.position = "none") +
  labs(title = "Compared to 2019 Average", 
       y = "Million", x = NULL, caption = myCaption)
ggsave("canada_employment_2_03.png", mp, width = 8, height = 4)
```

```{r echo = F, eval = F}
DT::datatable(xx %>% 
  filter(Date > "2020-02-15") %>% 
  select(Date, Measurement, PanDiff, MonthDiff) %>%
  mutate(PanDiff = round(PanDiff * 1000),
         MonthDiff = round(MonthDiff * 1000)) %>%
    arrange(desc(Date)))
```

---

## Monthly Change

![](canada_employment_2_04.png)

```{r}
# Prep data
yy <- d1 %>% 
  filter(Area == "Canada", Date == "2020-02-15", Age == "15 years and over",
         Sex == "Both sexes", Measurement %in% myMeasures)#, Measurement == "Employment")
         #         !grepl("rate", Measurement), Measurement != "Employment")
#i<-"2020-03-15"
for(i in unique(xx$Date)) {
  # Full-time
  xi <- xx$Value[xx$Date == i & xx$Measurement == "Full-time employment"] - 
    yy$Value[yy$Measurement == "Full-time employment"]
  xx$PanDiff[xx$Date == i & xx$Measurement == "Full-time employment"] <- xi
  # Part-time
  xi <- xx$Value[xx$Date == i & xx$Measurement == "Full-time employment"] - 
    yy$Value[yy$Measurement != "Full-time employment"]
  xx$PanDiff[xx$Date == i & xx$Measurement != "Full-time employment"] <- xi
  #
  yy <- d1 %>% 
  filter(Area == "Canada", Date == i, 
         Age == "15 years and over", Sex == "Both sexes", 
         Measurement %in% myMeasures)
}
xx <- xx %>% mutate(PosNeg = ifelse(PanDiff > 0, "Pos", "Neg"))
# Plot
mp <- ggplot(xx, aes(x = Date, y = PanDiff / 1000, fill = PosNeg)) + 
  geom_bar(stat = "identity", color = "black", alpha = 0.7) +
  facet_wrap(Measurement ~ ., scales = "free_y") +
  scale_fill_manual(values = c("darkred","steelblue")) +
  theme_agData(legend.position = "none") +
  labs(title = "Change each month since the start of the pandemic", 
       y = "Million", x = NULL, caption = myCaption)
ggsave("canada_employment_2_04.png", mp, width = 8, height = 4)
```

---

![](canada_employment_2_05.png)

```{r}
# Prep data
myMeasures <- c("Full-time employment", "Part-time employment")
xx <- d2 %>% 
  filter(Area == "Canada", Sex != "Both sexes",
         Age != "15 years and over") %>%
  mutate(Measurement = factor(Measurement, levels = rev(myMeasures)))
# Plot
mp <- ggplot(xx, aes(x = Year, y = Percent, fill = Measurement)) + 
  geom_bar(stat = "identity", color = "black", alpha = 0.6, lwd = 0.2) +
  facet_grid(Sex ~ Age, scales = "free_y") +
  scale_fill_manual(name = NULL, values = c("darkred","steelblue")) +
  theme_agData(legend.position = "bottom") +
  labs(title = "Employment in Canada", x = NULL, caption = myCaption)
ggsave("canada_employment_2_05.png", mp, width = 8, height = 4)
```

---

## Provinces

![](canada_employment_2_06.png)

```{r}
# Prep data
xx <- d1 %>% 
  filter(Area != "Canada", Sex == "Both sexes", 
         Age == "15 years and over",
         Measurement %in% myMeasures)
# Plot
mp <- ggplot(xx, aes(x = Date, y = Value / 1000, color = Measurement)) + 
  geom_line(size = 0.4, alpha = 0.7) +
  scale_color_manual(name = NULL, values = c("darkred","steelblue")) +
  facet_wrap(Area ~ ., scales = "free_y", ncol = 5) +
  theme_agData(legend.position = "bottom") +
  labs(title = "Compared to 2019 Average", 
       y = "Million", x = NULL, caption = myCaption)
ggsave("canada_employment_2_06.png", mp, width = 10, height = 4)
```

---
